<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dynamic Load Balancing — Colorful Dashboard (No Dropdowns)</title>
<style>
    :root{
        --bg1: #020d1c;
        --bg2: #000c19;
        --muted: #aabdd3;
        --accent-blue: #38bdf8;
        --accent-green: #34d399;
        --accent-amber: #f97316;
        --glass-border: rgba(255,255,255,0.12);
        --card-bg: rgba(255,255,255,0.04);
        --mono: "SFMono-Regular", Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
        --text-color: #e6f0ff;
    }
    *{box-sizing:border-box}
    body{
        margin:0; min-height:100vh; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
        background:
            radial-gradient(1000px 800px at 15% 15%, rgba(56,189,248,0.08), transparent 25%),
            radial-gradient(900px 600px at 85% 85%, rgba(52,211,153,0.06), transparent 20%),
            linear-gradient(180deg,var(--bg1),var(--bg2));
        color:var(--text-color);
        padding:40px 20px;
        display:flex; align-items:flex-start; justify-content:center;
    }

    .frame{
        width:100%; max-width:1150px; border-radius:18px; overflow:hidden;
        background: rgba(255,255,255,0.01);
        backdrop-filter: blur(8px);
        box-shadow: 0 30px 90px rgba(0,0,0,0.8);
        border: 2px solid var(--glass-border);
        display:grid; grid-template-columns: 440px 1fr; gap:0;
    }

    .left{
        padding:25px; background: linear-gradient(180deg,#03182b,#01101b);
        border-right:1px solid rgba(255,255,255,0.04);
    }
    .logo-row{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .logo{
        width:52px;height:52px;border-radius:12px;
        background:linear-gradient(135deg,var(--accent-blue),var(--accent-green));
        display:flex;align-items:center;justify-content:center;font-weight:900;color:#010e1a;box-shadow:0 8px 24px rgba(56,189,248,0.2);
        font-family: var(--mono); font-size: 20px;
    }
    h1{font-size:22px;margin:0;color:var(--accent-blue)}
    p.lead{margin:6px 0 20px;color:var(--muted);font-size:14px}

    .card{
        background: rgba(255,255,255,0.01);
        border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.04); margin-bottom:18px;
        transition: border-color 0.3s;
    }
    .card:hover { border-color: rgba(255,255,255,0.1); }

    label{display:block;font-size:14px;color:var(--accent-blue);margin-bottom:8px;font-weight:600}
    input[type="number"], input[type="text"]{
        width:100%; padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);
        background: rgba(255,255,255,0.01); color: var(--text-color); font-size:15px;
        transition: border-color 0.2s;
    }
    input:focus{outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 2px rgba(56,189,248,0.2);}
    .row{display:flex;gap:10px}
    .row .half{flex:1}

    .custom-display {
        display:flex; gap:10px; align-items:center; justify-content:space-between;
        padding:14px 16px; border-radius:12px; background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));
        border:1px solid rgba(255,255,255,0.04); font-weight:700; color:var(--muted);
    }
    .custom-display .label{color:var(--muted); font-size:13px}
    .custom-display .value{color:var(--text-color); font-size:16px; font-weight:900}

    table{width:100%; border-collapse:collapse; font-family:var(--mono); font-size:14px; color:#dff1ff; margin-top:5px;}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.05)}
    th{color:var(--muted); font-weight:700;font-size:12px;text-transform:uppercase}
    td small{color:var(--muted); display:block;font-size:12px}

    .add-row{display:flex;gap:10px;margin-top:14px}
    .btn{
        background:linear-gradient(90deg,var(--accent-blue),var(--accent-green)); color:#010e1a;padding:12px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:800;
        box-shadow: 0 6px 20px rgba(56,189,248,0.15);
        transition: transform .12s ease, box-shadow .2s;
    }
    .btn:hover{transform: translateY(-1px); box-shadow: 0 8px 24px rgba(56,189,248,0.25);}
    .btn:active{transform: translateY(0);}
    .btn.ghost{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1); color:var(--text-color);font-weight:600; box-shadow:none;}
    .btn.ghost:hover{background:rgba(255,255,255,0.1); transform: none;}
    .btn.warn{background:linear-gradient(90deg,var(--accent-amber),#ff5a00); color:#010e1a; box-shadow: 0 6px 20px rgba(249,115,22,0.3);}
    .btn.warn:hover{box-shadow: 0 8px 24px rgba(249,115,22,0.4);}

    .hint{font-size:12px;color:var(--muted);margin-top:8px}

    .right{
        padding:30px; background: linear-gradient(180deg, rgba(2,6,23,0.35), rgba(0,0,0,0.45));
    }
    .controls-top{display:flex;align-items:center;gap:16px;margin-bottom:20px}
    .chip{padding:10px 16px;border-radius:999px;background:rgba(255,255,255,0.04);font-size:14px;color:var(--accent-blue);border:1px solid rgba(255,255,255,0.08); font-weight: 600;}
    .run-btn{
        margin-left:auto;background: linear-gradient(90deg,#8b5cf6,#06b6d4); border:none;color:white;padding:14px 22px;border-radius:14px;font-weight:800; cursor:pointer;
        box-shadow: 0 10px 30px rgba(139,92,246,0.3);
        transform: translateY(0); transition: transform .15s ease, box-shadow .3s;
    }
    .run-btn:hover{transform: translateY(-2px); box-shadow: 0 15px 45px rgba(139,92,246,0.45);}
    .run-btn:active{transform: translateY(0)}
    .run-btn:focus{outline: none; box-shadow: 0 0 0 6px rgba(139,92,246,0.15) }

    .metrics{display:grid;grid-template-columns: repeat(3,1fr); gap:15px;margin-top:15px}
    .metric{
        background: rgba(255,255,255,0.02);
        padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);
        transition: background 0.3s;
    }
    .metric:hover { background: rgba(255,255,255,0.05); }
    .metric h3{margin:0;font-size:24px;color:var(--accent-green); font-weight: 800;}
    .metric p{margin:6px 0 0;color:var(--muted);font-size:14px}

    .console{
        margin-top:25px;background: linear-gradient(180deg,#000e16 0%, #001520 100%); border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.05);
        font-family: var(--mono); color: #cdebf5; font-size:14px; min-height:250px;
        box-shadow: inset 0 0 30px rgba(0,0,0,0.7);
        overflow-y: auto;
    }
    .line{display:block;padding:8px 10px;border-radius:8px;margin-bottom:5px; transition: background 0.3s}
    .sys{color:var(--accent-blue);background:linear-gradient(90deg,rgba(56,189,248,0.08),transparent)}
    .algo{color:var(--accent-green);background:linear-gradient(90deg,rgba(52,211,153,0.07),transparent)}
    .result{color:#ffd166;background:linear-gradient(90deg,rgba(255,209,102,0.05),transparent); font-weight: 600;}
    .error{color:#ff5a5a;background:linear-gradient(90deg,rgba(255,90,90,0.08),transparent)}
    .console .line:hover { background: rgba(255,255,255,0.02); }

    .bars{display:flex;gap:10px;margin-top:18px;height:16px}
    .bar{flex:1;height:100%;background:rgba(255,255,255,0.05);border-radius:8px;overflow:hidden;box-shadow:inset 0 1px 3px rgba(0,0,0,0.3)}
    .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent-blue),var(--accent-green)); width:0%; transition: width 1s cubic-bezier(0.25, 1, 0.5, 1)}

    .util-breakdown { margin-top:18px; display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px; }
    .proc-card {
        background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));
        padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04); min-height:72px;
    }
    .proc-card h4 { margin:0; font-size:14px; color:var(--accent-blue); display:flex; justify-content:space-between; align-items:center;}
    .proc-card ul { margin:8px 0 0 0; padding-left:14px; font-family:var(--mono); font-size:13px; color:#dff1ff; max-height:120px; overflow:auto; }
    .proc-card li { margin-bottom:6px; display:flex; justify-content:space-between; gap:8px; align-items:center; }
    .small-percent { color:var(--muted); font-size:12px; min-width:60px; text-align:right; }

    footer{margin-top:25px;color:var(--muted); font-size:13px;text-align:center}
    @media(max-width:980px){ .frame{grid-template-columns:1fr} .left{order:2} .right{order:1} .metrics{grid-template-columns:1fr} .util-breakdown{grid-template-columns:1fr} }
</style>
</head>
<body>

<div class="frame">
    <div class="left">
        <div class="logo-row">
            <div class="logo">DLB</div>
            <div>
                <h1>Dynamic Load Balancer</h1>
                <p class="lead">Interactive simulator for Multiprocessor Systems. Configure processes, choose an algorithm, and view the impact on system metrics.</p>
            </div>
        </div>

        <div class="card">
            <label>Hardware Configuration</label>

            <!-- Static displays (dropdowns removed) -->
            <div class="custom-display" role="group" aria-label="Hardware config display">
                <div>
                    <div class="label">Processors</div>
                    <div class="value" id="processorsDisplay">4</div>
                </div>
                <div>
                    <div class="label">Algorithm</div>
                    <div class="value" id="simModeDisplay">Adaptive (Push/Pull)</div>
                </div>
            </div>

            <!-- Hidden inputs (kept so existing JS works unchanged) -->
            <input type="hidden" id="processors" value="4">
            <input type="hidden" id="simMode" value="adaptive">
        </div>

        <div class="card">
            <label>Add Process (Task Configuration)</label>
            <div class="row">
                <input id="pname" type="text" placeholder="PID (e.g., P1)" aria-label="Process ID" />
            </div>
            <div class="row" style="margin-top:10px;">
                <div class="half"><input id="arrival" type="number" placeholder="Arrival time (e.g., 0)" aria-label="Arrival time" /></div>
                <div class="half"><input id="burst" type="number" placeholder="Burst time (e.g., 5)" aria-label="Burst time" /></div>
            </div>
            <div class="add-row">
                <button class="btn" id="addProc" title="Add process">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:4px"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    Add Task
                </button>
                <button class="btn warn" id="fillSample" title="Fill sample">Load Sample Tasks</button>
                <button class="btn ghost" id="clearProcs" title="Clear processes">Clear All</button>
            </div>
            <div style="margin-top:16px;color:var(--muted);font-size:13px">
                Total Processes Queued: <strong id="procCount" style="color:var(--accent-green)">0</strong>
            </div>
        </div>

        <div class="card" style="padding:10px">
            <table id="ptable" aria-label="process-table">
                <thead>
                    <tr><th>PID</th><th>Arrival (t)</th><th>Burst (t)</th><th></th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="right">
        <div class="controls-top">
            <div class="chip">Algorithm: <strong id="modeLabel">Adaptive (Push/Pull)</strong></div>
            <div class="chip">Processors: <strong id="procLabel">4</strong></div>
            <div class="chip">Tasks: <strong id="procLabel2">0</strong></div>
            <button class="run-btn" id="runSim" aria-label="Run simulation">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:8px"><path fill="white" d="M8 5v14l11-7z"/></svg>
                Run Simulation
            </button>
        </div>

        <div class="metrics">
            <div class="metric">
                <h3 id="m_wait">-</h3>
                <p>Average Waiting Time</p>
            </div>
            <div class="metric">
                <h3 id="m_resp">-</h3>
                <p>Average Response Time</p>
            </div>
            <div class="metric">
                <h3 id="m_mig">-</h3>
                <p>Task Migrations (Overhead)</p>
            </div>
        </div>

        <div class="console" id="console">
            <div class="line sys">[SYSTEM] Dashboard Initialized. Load tasks and press <strong>Run Simulation</strong> to begin.</div>
            <div class="line algo">[DLB_ALGO] Status: Awaiting Input.</div>
            <div class="line result" style="display:none" id="finalLine"></div>
        </div>

        <p style="color:var(--muted);font-size:14px;margin-bottom:8px;margin-top:18px">Processor Utilization (%)</p>
        <div class="bars" style="margin-top:12px">
            <div class="bar"><i id="b1" style="width:0%"></i></div>
            <div class="bar"><i id="b2" style="width:0%"></i></div>
            <div class="bar"><i id="b3" style="width:0%"></i></div>
            <div class="bar"><i id="b4" style="width:0%"></i></div>
        </div>

        <!-- NEW: Utilization Breakdown per Processor -->
        <div class="util-breakdown" id="utilBreakdown" aria-live="polite" style="margin-top:16px">
            <!-- dynamically generated processor cards appear here -->
        </div>

        <footer>
            Academic Project Demo | Dynamic Load Balancing in Multiprocessor Systems
        </footer>
    </div>
</div>

<script>
    // --- JAVASCRIPT LOGIC (with utilization breakdown) ---

    // note: processors and simMode are hidden inputs, but JS references them by id (kept for compatibility)
    const processors = document.getElementById('processors');
    const simMode = document.getElementById('simMode');
    const procLabel = document.getElementById('procLabel');
    const procLabel2 = document.getElementById('procLabel2');
    const modeLabel = document.getElementById('modeLabel');
    const ptable = document.querySelector('#ptable tbody');
    const procCount = document.getElementById('procCount');
    const utilBreakdown = document.getElementById('utilBreakdown');
    const processorsDisplay = document.getElementById('processorsDisplay');
    const simModeDisplay = document.getElementById('simModeDisplay');

    let procs = []; // array of {pid, arrival, burst}

    function refreshCounts(){
        // read from hidden inputs (their values can be changed programmatically if needed)
        procLabel.textContent = processors.value;
        processorsDisplay.textContent = processors.value;
        procLabel2.textContent = procs.length;
        procCount.textContent = procs.length;
        modeLabel.textContent = (simMode.value === 'adaptive') ? 'Adaptive (Push/Pull)' :
                                (simMode.value === 'sender') ? 'Sender-Initiated' :
                                (simMode.value === 'receiver') ? 'Receiver-Initiated' : 'No Balancing';
        simModeDisplay.textContent = modeLabel.textContent;
    }

    document.getElementById('addProc').addEventListener('click', ()=>{
        const pid = document.getElementById('pname').value.trim() || ('P' + (procs.length+1));
        const arrival = Number(document.getElementById('arrival').value) || 0;
        const burst = Math.max(1, Number(document.getElementById('burst').value) || 1);
        procs.push({pid, arrival, burst});
        renderTable();
        clearInputs();
        refreshCounts();
    });

    function renderTable(){
        ptable.innerHTML = '';
        procs.forEach((p, i)=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${p.pid}</td><td>${p.arrival}</td><td>${p.burst}</td><td><button class="btn ghost" data-i="${i}" title="Remove">✕</button></td>`;
            ptable.appendChild(tr);
        });
        document.querySelectorAll('#ptable button').forEach(b=>{
            b.addEventListener('click', e=>{
                const i = Number(e.target.dataset.i);
                procs.splice(i,1); renderTable(); refreshCounts();
            });
        });
    }

    function clearInputs(){
        document.getElementById('pname').value='';
        document.getElementById('arrival').value='';
        document.getElementById('burst').value='';
    }

    document.getElementById('clearProcs').addEventListener('click', ()=>{
        procs=[]; renderTable(); refreshCounts();
    });

    document.getElementById('fillSample').addEventListener('click', ()=>{
        procs = [
            {pid:'P1', arrival:0, burst:8},
            {pid:'P2', arrival:1, burst:2},
            {pid:'P3', arrival:2, burst:6},
            {pid:'P4', arrival:3, burst:4},
            {pid:'P5', arrival:4, burst:7},
            {pid:'P6', arrival:5, burst:3}
        ];
        renderTable(); refreshCounts();
    });

    // If you want to change hidden values programmatically, you can do:
    // processors.value = '4'; simMode.value = 'adaptive'; then call refreshCounts();

    refreshCounts();

    // Fake-run simulator: produces visually pleasing numbers and breakdown
    document.getElementById('runSim').addEventListener('click', ()=>{
        if(procs.length===0){
            flashConsole('[SYSTEM] Add at least one process to run the demo.','error'); return;
        }
        runDemo();
    });

    function flashConsole(text, cls='sys'){
        const c = document.getElementById('console');
        const el = document.createElement('div');
        el.className = 'line ' + cls;
        el.innerHTML = text;
        c.appendChild(el);
        c.scrollTop = c.scrollHeight;
    }

    function runDemo(){
        // Clear and start
        document.getElementById('console').innerHTML = '';
        utilBreakdown.innerHTML = ''; // clear previous breakdown
        flashConsole('[SYSTEM] Launching simulation...', 'sys');
        flashConsole(`[DLB_ALGO] Mode: ${simMode.value.toUpperCase()} | Processor Count: ${processors.value}`, 'algo');

        const pcount = Number(processors.value);
        if (pcount > 8) {
            flashConsole('[SIM] Visualization best experience: use up to 8 processors.', 'sys');
        }

        // Assign tasks round-robin to processors for demo (simple approach)
        const assignment = Array.from({length:pcount}, ()=>[]);
        procs.forEach((p, idx)=>{
            assignment[idx % pcount].push(p);
        });

        // calculate simple metrics (toy)
        const totalBurst = procs.reduce((s,p)=>s+p.burst,0);
        const avgBurst = totalBurst / procs.length;
        const noLbAvgWait = (avgBurst * 1.4).toFixed(1);
        const noLbAvgResp = (avgBurst * 2.0).toFixed(1);

        // dynamic effect based on imbalance
        const imbalance = calcImbalance(assignment); // normalized
        let improvement = 0;
        if (simMode.value === 'none') {
            improvement = 0.05 + imbalance * 0.05;
        } else if (simMode.value === 'sender' || simMode.value === 'receiver') {
            improvement = 0.15 + imbalance * 0.12;
        } else {
            improvement = 0.25 + imbalance * 0.15;
        }

        const dlbWait = (noLbAvgWait * (1 - improvement)).toFixed(1);
        const dlbResp = (noLbAvgResp * (1 - improvement)).toFixed(1);
        const migrations = Math.max(0, Math.round(procs.length * improvement * 0.8 * (simMode.value === 'none' ? 0 : 1)));

        // produce usage percentages per-processor (toy distribution, normalized to totalBurst)
        const procTotals = assignment.map(q => q.reduce((s, x) => s + x.burst, 0));
        const rawUtils = procTotals.map(t => Math.round((t / (totalBurst || 1)) * 100));
        const utils = rawUtils.map(u => Math.min(98, Math.max(8, Math.round(u + (Math.random()-0.5)*15 * (simMode.value === 'none' ? 0.5 : 1.1)))));

        const avgUtil = utils.reduce((a,b)=>a+b,0) / (utils.length || 1);
        if (simMode.value !== 'none' && avgUtil < 60){
            for (let i=0;i<utils.length;i++) utils[i] = Math.min(95, utils[i] + 8);
        }

        // Animate bars (first four bars for quick glance)
        const barEls = [document.getElementById('b1'), document.getElementById('b2'), document.getElementById('b3'), document.getElementById('b4')];
        for(let i=0;i<4;i++){
            const val = Math.round(utils[i % utils.length] || 0);
            setTimeout(()=>{ if(barEls[i]) barEls[i].style.width = val + '%'; }, 400 + i*200);
        }

        // Populate metric fields
        document.getElementById('m_wait').textContent = dlbWait + ' t.u.';
        document.getElementById('m_resp').textContent = dlbResp + ' t.u.';
        document.getElementById('m_mig').textContent = migrations;

        // Build utilization breakdown cards
        renderUtilBreakdown(assignment, utils, procTotals, totalBurst);

        // Log outcome
        setTimeout(()=>{
            flashConsole('[RESULT] Simulation complete. Performance Summary:', 'result');
            flashConsole(`  - Total tasks completed: ${procs.length}`, 'result');
            flashConsole(`  - Avg Waiting Time (No LB): ${noLbAvgWait}  | ${simMode.value.toUpperCase()}: ${dlbWait}`, 'result');
            flashConsole(`  - Avg Response Time (No LB): ${noLbAvgResp} | ${simMode.value.toUpperCase()}: ${dlbResp}`, 'result');
            flashConsole(`  - Task Migrations Performed: ${migrations}`, 'result');

            if (simMode.value !== 'none') {
                const waitReduction = ((noLbAvgWait - dlbWait) / noLbAvgWait * 100).toFixed(0);
                flashConsole(`[CONCLUSION] Wait Time Reduced by ~${waitReduction}% due to effective load balancing.`, 'algo');
            } else {
                 flashConsole(`[CONCLUSION] Performance aligns with baseline expectations (No Load Balancing).`, 'sys');
            }
        }, 1200);
    }

    function renderUtilBreakdown(assignment, utils, procTotals, totalBurst){
        utilBreakdown.innerHTML = ''; // clear

        // For each processor create a card with utilization and assigned processes
        assignment.forEach((procList, idx) => {
            const pid = idx + 1;
            const total = procTotals[idx] || 0;
            const card = document.createElement('div');
            card.className = 'proc-card';

            const header = document.createElement('h4');
            header.innerHTML = `Processor P${pid} <span style="font-size:13px;color:var(--muted)">${utils[idx] || 0}%</span>`;
            card.appendChild(header);

            if (procList.length === 0) {
                const emptyNote = document.createElement('div');
                emptyNote.style.color = 'var(--muted)';
                emptyNote.style.marginTop = '8px';
                emptyNote.textContent = 'No tasks assigned (idle)';
                card.appendChild(emptyNote);
            } else {
                const ul = document.createElement('ul');
                procList.forEach(p => {
                    const li = document.createElement('li');
                    const contributionPct = total ? ((p.burst / total) * 100) : 0;
                    li.innerHTML = `<span>${p.pid} &nbsp;<small style="color:var(--muted)">(burst: ${p.burst})</small></span><span class="small-percent">${contributionPct.toFixed(0)}%</span>`;
                    ul.appendChild(li);
                });
                card.appendChild(ul);
            }

            utilBreakdown.appendChild(card);
        });

        if (assignment.length > 4){
            const note = document.createElement('div');
            note.style.gridColumn = '1/-1';
            note.style.color = 'var(--muted)';
            note.style.fontSize = '13px';
            note.style.marginTop = '6px';
            note.textContent = `Showing utilization breakdown for all ${assignment.length} processors. Note: visual bars are limited to first 4 processors for quick glance.`;
            utilBreakdown.appendChild(note);
        }
    }

    function calcImbalance(assign){
        const sums = assign.map(q=> q.reduce((s,x)=>s+x.burst,0));
        const avg = sums.reduce((a,b)=>a+b,0)/sums.length || 0;
        const variance = sums.reduce((a,b)=>a + Math.pow((b-avg),2),0)/sums.length || 0;
        const std = Math.sqrt(variance);
        return avg ? (std/ (avg||1)) : 0;
    }
</script>

</body>
</html>
